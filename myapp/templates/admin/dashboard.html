{% extends "admin/base_site.html" %}

{% block extrahead %}
<script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body {
    background-color: #12141c;
    color: #fff;
    font-family: "Segoe UI", sans-serif;
    margin:0;
    padding:0;
}

/* Sidebar */
.sidebar {
    position: fixed;
    top: 60px;
    left: 0;
    width: 220px;
    height: 100%;
    background-color: #1f222e;
    padding-top: 25px;
    display: flex;
    flex-direction: column;
    gap: 12px;
    box-shadow: 2px 0 8px rgba(0,0,0,0.6);
    z-index: 100;
}

.sidebar a {
    color: #00c0ef;
    text-decoration: none;
    padding: 10px 20px;
    display: flex;
    align-items: center;
    gap: 12px;
    border-radius: 8px;
    transition: all 0.3s ease;
}

.sidebar a:hover {
    background-color: #2a2d3b;
    transform: translateX(5px);
}

/* Main content */
.main-content {
    margin-left: 220px;
    padding: 25px 30px;
    width: calc(100% - 220px);
}

/* Stat cards */
.stat-card {
    display: flex;
    align-items: center;
    background: linear-gradient(135deg, #2a2d3b, #1f222e);
    padding: 20px 25px;
    border-radius: 15px;
    gap: 15px;
    box-shadow: 0 6px 15px rgba(0,0,0,0.4);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
    flex: 1 1 30%;
    min-width: 220px;
}

.stat-card:hover {
    transform: scale(1.05);
    box-shadow: 0 12px 25px rgba(0,0,0,0.6);
}

.stat-card i {
    font-size: 42px;
    color: #00c0ef;
}

.stat-card .stat-info .number {
    font-size: 28px;
    font-weight: bold;
}

.stat-card .stat-info .label {
    font-size: 14px;
    color: #aaa;
    margin-top: 3px;
}

/* Table */
table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 10px;
    font-size: 15px;
}

table th, table td {
    padding: 12px 8px;
    text-align: left;
}

table th {
    background-color: #1f222e;
    color: #fff;
}

table tr:nth-child(even) { background-color: #2a2d3b; }
table tr:nth-child(odd) { background-color: #232634; }
table tr:hover { background-color: #33364d; }

/* Chart */
.chart-card {
    background-color: #1f222e;
    border-radius: 15px;
    padding: 20px;
    box-shadow: 0 6px 15px rgba(0,0,0,0.4);
    height: 100%;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
}

/* Chart title */
.chart-card h3 {
    color: #00c0ef;
    margin-bottom: 15px;
}

/* Flex wrapper pour tableau + graphique */
.dashboard-row {
    display: flex;
    gap: 20px;
    margin-top: 25px;
}

/* Chaque colonne - m√™me largeur et hauteur */
.dashboard-col {
    flex: 1 1 0;
    min-width: 300px;
    display: flex;
    flex-direction: column;
}

/* Tableau et graphique remplissent la colonne */
.dashboard-col .chart-card {
    flex: 1;
    max-height: 500px;
    width: 100%;
}

/* Canvas responsive */
.dashboard-col canvas {
    width: 100% !important;
    height: auto !important;
}

/* Flex wrap pour stat cards */
.cards-wrapper {
    display: flex;
    flex-wrap: wrap;
    gap: 15px;
}
</style>
{% endblock %}

{% block content %}
<div class="sidebar">
    <a href="{% url 'admin:myapp_category_changelist' %}"><i class="fas fa-tags"></i> Categories</a>
    <a href="{% url 'admin:myapp_commande_changelist' %}"><i class="fas fa-shopping-cart"></i> Commandes</a>
    <a href="{% url 'admin:myapp_supplier_changelist' %}"><i class="fas fa-truck"></i> Fournisseurs</a>
    <a href="{% url 'admin:myapp_product_changelist' %}"><i class="fas fa-box"></i> Produits</a>
</div>

<div class="main-content">
    <!-- Stat cards -->
    <div class="cards-wrapper">
        <div class="stat-card"><i class="fas fa-box"></i>
            <div class="stat-info"><span class="number">{{ products_count }}</span><span class="label">Produits</span></div>
        </div>
        <div class="stat-card"><i class="fas fa-clock"></i>
            <div class="stat-info"><span class="number">{{ orders_pending }}</span><span class="label">Commandes en attente</span></div>
        </div>
        <div class="stat-card"><i class="fas fa-check-circle"></i>
            <div class="stat-info"><span class="number">{{ orders_delivered }}</span><span class="label">Commandes livr√©es</span></div>
        </div>
    </div>

    <!-- Dashboard row: Bar chart + Tableau -->
    <div class="dashboard-row">
        <!-- Bar chart -->
        <div class="dashboard-col">
            <div class="chart-card">
                <h3>Commandes Livr√©es / En attente</h3>
                <canvas id="barChart"></canvas>
            </div>
        </div>

        <!-- 5 derni√®res commandes -->
        <div class="dashboard-col">
            <div class="chart-card">
                <h3>üõí 5 Derni√®res commandes</h3>
                <table>
                    <thead>
                        <tr>
                            <th>Client</th>
                            <th>Produit</th>
                            <th>Quantit√©</th>
                            <th>Paiement</th>
                            <th>Statut</th>
                            <th>Date</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for cmd in commande %}
                        <tr>
                            <td>{{ cmd.customer_name }}</td>
                            <td>{{ cmd.product.name }}</td>
                            <td>{{ cmd.quantity }}</td>
                            <td>{{ cmd.payment }}</td>
                            <td>
                                {% if cmd.is_delivered %}
                                    <span style="color:#00a65a; font-weight:bold;">‚úî Livr√©e</span>
                                {% else %}
                                    <span style="color:#f39c12; font-weight:bold;">‚è≥ En attente</span>
                                {% endif %}
                            </td>
                            <td>{{ cmd.created_at|date:"d/m/Y H:i" }}</td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="6" style="color:#ccc; text-align:center;">
                                Aucune commande enregistr√©e
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function () {
    const data = {
        labels: ["Livr√©es", "En attente"],
        datasets: [{
            label: 'Nombre de commandes',
            data: [{{ orders_delivered }}, {{ orders_pending }}],
            backgroundColor: ['#00a65a', '#f39c12'],
            borderColor: ['#00a65a', '#f39c12'],
            borderWidth: 1
        }]
    };

    const config = {
        type: 'bar', // type b√¢ton
        data: data,
        options: {
            responsive: true,
            plugins: {
                legend: { display: false },
                tooltip: {
                    backgroundColor: '#1f222e',
                    titleColor: '#00c0ef',
                    bodyColor: '#fff',
                    titleFont: { weight: 'bold' }
                }
            },
            scales: {
                x: {
                    ticks: { color: 'white', font: { size: 14 } },
                    grid: { color: 'rgba(255,255,255,0.1)' }
                },
                y: {
                    beginAtZero: true,
                    ticks: { color: 'white', font: { size: 14 }, stepSize: 1 },
                    grid: { color: 'rgba(255,255,255,0.1)' }
                }
            }
        }
    };

    const ctx = document.getElementById('barChart');
    new Chart(ctx, config);
});
</script>

{% endblock %}
